<!DOCTYPE html>
<!--http://www.kirupa.com/html5/create_an_analog_clock_using_the_canvas.htm-->
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Smartclock MISA</title>
    <style>
        .body {
            background-color: black;
        }

        #current-time {
            display: block;
            font-weight: bold;
            text-align: center;
            width: 200px;
            padding: 10px;
        }

        #clock {
            border: 1px solid #000000;
        }
    </style>
</head>

<body class="body">
<!-- TODO redesign pour format rectangle height="1280px" -->
<canvas id="clock" height="800px" width="800px" >
    If you can see this message, your browser does not support canvas
    and needs an upate. Sorry. :(
</canvas>


<script>
    (function () {

        //TODO mettre l'init dans un constructeur
        var canvas = document.getElementById("clock");
        var context = canvas.getContext("2d");

        // Rayon de l'horloge
        var clockRadius = canvas.width / 2;

        // Center clock in the canvas
        var centerX = canvas.width / 2;
        var centerY = canvas.height / 2;

        // Must define TAU
        Math.TAU = 2 * Math.PI;

        document.addEventListener('DOMContentLoaded', startTimer);
        //TODO end init

        function startTimer() {
            setInterval(updateClock, 1000);
        }

        function updateClock() {
            resetCanvas(context, canvas);

            drawOriginCircle();

            drawHourMarkers();

            drawAnalogTime();
        }

        function drawAnalogTime() {
            var now = new Date();

            //TODO passer une config {} au drawArm

            var hour = now.getHours() % 12;
            var min = now.getMinutes();
            var sec = now.getSeconds();

            var secProgress = (sec / 60);
            var minProgress = (min / 60) + (1 / 60) * secProgress;
            var hourProgress = (hour / 12) + (1 / 12) * minProgress;

            const hourThickness = 6;
            const minThickness = 4;
            const secThickness = 2;

            const hourArmLengthPercent = 0.45;
            const minArmLengthPercent = 0.60;
            const secArmLengthPercent = 0.72;

            drawArm(hourProgress, hourThickness, hourArmLengthPercent, '#FFFFFF');
            drawArm(minProgress, minThickness, minArmLengthPercent, '#FFFFFF');
            drawArm(secProgress, secThickness, secArmLengthPercent, '#FF0000');
        }

        function resetCanvas() {
            context.clearRect(0, 0, canvas.width, canvas.height);
        }

        function drawOriginCircle() {
            context.beginPath();
            context.arc(centerX, centerY, 7, 0, 2 * Math.PI);
            context.fillStyle = "white";
            context.fill();
        }

        /**
         * Dessine les rep√®res pour les heures dans le fond
         */
        function drawHourMarkers() {
            for (var i = 0; i < 12; i++) {
                var drawingStartDistance = 0.7;
                var drawingStopDistance = 1.0;
                context.lineWidth = 6;

                if (i % 3) {
                    drawingStartDistance = 0.75;
                    drawingStopDistance = 1.20;
                    context.lineWidth = 4;
                }

                //Set Style for hour markers
                context.strokeStyle = '#FFFFFF';

                var armRadians = (Math.TAU * (i / 12)) - (Math.TAU / 4);
                var x1 = centerX + Math.cos(armRadians) * (drawingStartDistance * clockRadius);
                var y1 = centerY + Math.sin(armRadians) * (drawingStartDistance * clockRadius);
                var x2 = centerX + Math.cos(armRadians) * (drawingStopDistance * clockRadius);
                var y2 = centerY + Math.sin(armRadians) * (drawingStopDistance * clockRadius);

                context.beginPath();
                context.moveTo(x1, y1); // Start at the center
                context.lineTo(x2, y2); // Draw a line outwards
                context.stroke();
            }
        }

        /**
         * Dessine une aiguille
         * @param progress
         * @param armThickness
         * @param armLength
         * @param armColor
         */
        function drawArm(progress, armThickness, armLength, armColor) {
            var armRadians = (Math.TAU * progress) - (Math.TAU / 4);
            var targetX = centerX + Math.cos(armRadians) * (armLength * clockRadius);
            var targetY = centerY + Math.sin(armRadians) * (armLength * clockRadius);

            var outCenterX = centerX + Math.cos(armRadians) * (15);
            var outCenterY = centerY + Math.sin(armRadians) * (15);

            context.lineWidth = armThickness;
            context.strokeStyle = armColor;

            context.beginPath();
            context.moveTo(outCenterX, outCenterY); // Start at the center
            context.lineTo(targetX, targetY); // Draw a line outwards
            context.stroke();
        }
    })();
</script>

</body>
</html>