<!DOCTYPE html>
<!--http://www.kirupa.com/html5/create_an_analog_clock_using_the_canvas.htm-->
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Smartclock MISA</title>
    <style>
        .body {
            background-color: black;
        }
        #clock {
            border: 1px solid #000000;
        }
    </style>
</head>
<body class="body">
<!-- TODO redesign pour format rectangle height="1280px" -->
<canvas id="clock" height="800px" width="800px" >
    If you can see this message, your browser does not support canvas
    and needs an upate. Sorry. :(
</canvas>
<script>
    (function () {

        //TODO mettre l'init dans un constructeur
        var canvas = document.getElementById("clock");
        var context = canvas.getContext("2d");

        // Rayon de l'horloge
        var clockRadius = canvas.width / 2;

        // Center clock in the canvas
        var centerX = canvas.width / 2;
        var centerY = canvas.height / 2;

        // Must define TAU
        Math.TAU = 2 * Math.PI;

        document.addEventListener('DOMContentLoaded', startTimer);
        //TODO end init

        function startTimer() {
            setInterval(updateClock, 1000);
        }

        function updateClock() {
            resetCanvas();
            drawOriginCircle();
            drawHourMarkers();
            drawAnalogTime();
            drawNumericTime();
        }

        function resetCanvas() {
            context.clearRect(0, 0, canvas.width, canvas.height);
        }

        function drawOriginCircle() {
            context.beginPath();
            context.arc(centerX, centerY, 7, 0, 2 * Math.PI);
            context.fillStyle = "white";
            context.fill();
        }

        /**
         * Dessine les repères pour les heures dans le fond
         */
        function drawHourMarkers() {
            context.strokeStyle = '#FFFFFF';
            for (var hour = 0; hour < 12; hour++) {
                var isQuarter = !(hour % 3);
                if (isQuarter) {
                    context.lineWidth = 6;
                    drawLine(hour / 12, 0.7, 1);
                } else {
                    context.lineWidth = 4;
                    drawLine(hour / 12, 0.8, 1.2);
                }
            }
        }

        function drawAnalogTime() {
            var now = new Date();

            var secProgress = now.getSeconds() / 60;
            var minProgress = now.getMinutes() / 60 + (1 / 60) * secProgress;
            var hourProgress = (now.getHours() % 12) / 12 + (1 / 12) * minProgress;

            drawArm({
                progress: hourProgress,
                thickness: 6,
                length: 0.45,
                color: '#FFFFFF'
            });
            drawArm({
                progress: minProgress,
                thickness: 4,
                length: 0.60,
                color: '#FFFFFF'
            });
            drawArm({
                progress: secProgress,
                thickness: 2,
                length: 0.72,
                color: '#FF0000'
            });
        }

        function drawArm(params) {
            const shiftFromCenter = 15;
            context.lineWidth = params.thickness;
            context.strokeStyle = params.color;
            drawLine(params.progress, shiftFromCenter / clockRadius, params.length);
        }

        /**
         * @param progress pourcentage de progression ex: 3h = 15min = 0.25; 6h = 30 min = 0.5
         * @param beginPercent début de la ligne en % du rayon
         * @param endPercent fin de la ligne en % du rayon
         */
        function drawLine(progress, beginPercent, endPercent) {
            var armRadians = (Math.TAU * (progress)) - (Math.TAU / 4);
            var startingPointX = centerX + Math.cos(armRadians) * (beginPercent * clockRadius);
            var startingPointY = centerY + Math.sin(armRadians) * (beginPercent * clockRadius);
            var endingPointX = centerX + Math.cos(armRadians) * (endPercent * clockRadius);
            var endingPointY = centerY + Math.sin(armRadians) * (endPercent * clockRadius);

            context.beginPath();
            context.moveTo(startingPointX, startingPointY);
            context.lineTo(endingPointX, endingPointY);
            context.stroke();
        }

        function drawNumericTime() {
            var now = new Date();
            context.strokeStyle = "#FFFFFF";
            context.textAlign = 'center';

            var daysOfWeek = ['DIM', 'LUN', 'MAR', 'MER', 'JEU', 'VEN', 'SAM'];
            context.font = "80pt Calibri";
            context.fillText(daysOfWeek[now.getDay()], centerX, centerY - clockRadius / 3);

            context.font = "55pt Calibri";
            var dateDay = now.getDate() + "/" + padZero(now.getMonth());
            context.fillText(dateDay, centerX, centerY - clockRadius / 6);
        }

        function padZero(num) {
            var paddedString = String(num)
            if (num < 10) {
                paddedString = "0" + String(num);
            }
            return paddedString;
        }

    })();
</script>

</body>
</html>